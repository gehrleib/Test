The Issue: Following the November 27th release, the automated process responsible for cleaning up "Retired" controls failed specifically for the High-Level Plan application. While controls were correctly removed from other workflows (e.g., Assessable Unit, Control Assessment), they remained attached to High-Level Plans.

Root Cause: A specific logic gap was identified in the cleanup job for High-Level Plans.

Technical Constraint: A High-Level Plan record strictly requires an association with an Assessable Unit.

The Conflict: When a Control is marked as "Retired," it is disassociated from its Assessable Unit.

The Failure: Because the cleanup process failed to remove these now-orphaned controls from the High-Level Plans, the Plans were left holding controls that no longer had the required Assessable Unit parent. This creates a data integrity violation and prevents successful export to CALMA.

Technical Solution
To resolve this, we updated the retirement cleanup logic to enforce the following rules:

Scope Expansion: The cleanup job was modified to explicitly query the High-Level Plan application (previously omitted/failing).

Filtering Logic: The process now identifies target records based on the intersection of three conditions:

Control Status: IS "Retired"

Plan Status: IS "Incomplete" (Draft), "Substantially Complete", OR "Complete" (Approved)

Integration Flag: Exported to CALMA IS "No" (List Value ID: 73938)

Remediation Action: For records matching the criteria above, the system now forces a disassociation of the Control from the High-Level Plan. This ensures that when the Plan is eventually exported, it does not contain invalid/orphaned controls.

Historical Preservation: Added a safety check to ensure that any Plan where Exported to CALMA IS "Yes" is strictly ignored, preserving the integrity of historical data already present in downstream systems.
